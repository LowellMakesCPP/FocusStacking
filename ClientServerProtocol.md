# Protocol for communication between FocusStacking ImageServer and clients


Reference: [TCP/IP Protocol Design: Message Framing, by **Stephen Cleary**, 25 Jun 2009](http://www.codeproject.com/Articles/37496/TCP-IP-Protocol-Design-Message-Framing)

1. Messages are encoded in [ASCII](http://en.wikipedia.org/wiki/ASCII), binary data are encoded in hex within a message.
2. Each message unit starts with a NUL (Acsii code: 000) character followed by a four character message code (case sensitive), followed by data that depends on the message.
3. Each message ends with a ETX (Ascii code: 004, End of Transmission).
4. Data can never contain the characters NUL or ETX.
5. Messages are at most 10240 bytes (= 10 KB) in length. Longer data transfers are split into multiple segments.
6. The same message id can be used for the query or request and reply from server.

The following messages are defined:

1. **GTID**: get stack id. Sent from client to server to request for a new stack id. There is no data associated with this message. Thus a full message would look like: "_\000GTID\004_". Server returns newly assigned stack id to client. A stack id is a [UUID](http://en.wikipedia.org/wiki/Universally_unique_identifier) generated by the server that is guaranteed to be unique for a given database. The data consists of 32 lower-case hexadecimal digits. Thus a full message could look like: "_\000GTID123e4567e89b12d3a456426655440000\004_".
3. **PING**: ping server. Client requests server for identification. Server returns version and database information. Example: "_\000PING\004_" "_\000PING FocusStacking ImageServer version 0.1 \nDatabase: Microscopy Collection\004_".
4. **LSTN**: number of stacks in database. Client requests server for list of stacks stored in the database. Server returns number in lowercase hexadecimal. The maximum number of stacks in a database is 2^32 = 4294967296. For example if there are 29 stacks, the communication could look like: "_\000LSTN\004_" "_\000LSTN1d\004_". If there aren't any stacks in the database yet, the server should return: "_\000LSTN0\004_" where '0' after LSTN is the ASCII character '\060'.


